# IAP Performance Simulation Tool ğŸš€

This tool uses **k6** to simulate realistic user lifecycles and backend pressure for our In-App Purchase system.

## ğŸ—ï¸ Architecture vs Simulation
The simulation is designed to mimic:
1.  **User Onboarding**: Parallel registrations and identity creation.
2.  **Access Verification**: High-frequency checks on protected API endpoints.
3.  **Revenue Events**: Webhook bursts (Stripe, Apple, Google) to stress-test asynchronous workers.
4.  **Admin Oversight**: Dashboard metric polling for analytics.

## ğŸƒ Running the Simulation

### 1. Prerequisites
Install k6:
```bash
brew install k6
```

### 2. Configure Local/Dev Environment
By default, it targets `http://localhost:8080`. You can override this using environment variables:
```bash
# Example: Targeting a Dev environment
export ROOT_URL=https://api-dev.bivex.io
```

### 3. Run Different Scenarios

#### **Standard Lifecycle Test (Balanced Load)**
Full user journey from registration to purchase.
```bash
k6 run tests/load/iap_simulation.js
```

#### **Webhook Stress Test (High Volume Revenue)**
High-rate webhook simulations to test worker processing speed.
```bash
k6 run --scenario webhook_burst tests/load/iap_simulation.js
```

#### **Stress/Soak Test (Long Duration)**
Check for memory leaks or database connection exhaustion under 100 VUs.
```bash
k6 run tests/load/stress_test.js
```

## ğŸ“Š Visualizing Results
For a "beautiful" experience, you can output results directly to **Grafana Cloud** or use the k6 local dashboard:

```bash
# Output to local file for analysis
k6 run --out json=results.json tests/load/iap_simulation.js
```

---
Generated by Antigravity AI â€” *Keep it scaling!* âš¡
